<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å¤©å¹³å®ˆè­·è€…çš„è©¦ç…‰ (é€²éšç‰ˆ)</title>
    <style>
        :root {
            --primary-color: #6a1b9a;
            --secondary-color: #ffca28;
            --bg-color: #f3e5f5;
            --text-color: #4a148c;
            --wrong-color: #d32f2f;
            --correct-color: #388e3c;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: var(--bg-color);
            color: var(--text-color);
            display: flex;
            flex-direction: column;
            align-items: center;
            min-height: 100vh;
            margin: 0;
            padding: 20px;
        }

        h1 { margin-bottom: 10px; }
        
        .game-container {
            width: 100%;
            max-width: 800px;
            background: white;
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.1);
            text-align: center;
            position: relative;
        }

        .balance-area {
            height: 250px;
            position: relative;
            margin: 40px 0;
            display: flex;
            justify-content: center;
            align-items: flex-end;
        }

        .balance-beam {
            width: 400px;
            height: 10px;
            background-color: #555;
            position: absolute;
            top: 50px;
            left: 50%;
            margin-left: -200px;
            transition: transform 0.5s cubic-bezier(0.4, 2.5, 0.4, 0.8);
            z-index: 2;
        }

        .balance-stand {
            width: 20px;
            height: 200px;
            background-color: #333;
            position: absolute;
            bottom: 0;
            left: 50%;
            margin-left: -10px;
            z-index: 1;
        }

        .pan {
            width: 100px;
            height: 80px;
            border: 4px solid #555;
            border-top: none;
            border-radius: 0 0 50px 50px;
            position: absolute;
            top: 10px;
            background: rgba(255, 215, 0, 0.2);
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 24px;
            font-weight: bold;
            flex-direction: column;
        }

        .pan-left { left: -50px; }
        .pan-right { right: -50px; }
        
        .pan::before {
            content: '';
            position: absolute;
            top: -40px;
            left: 50%;
            width: 2px;
            height: 40px;
            background: #555;
        }
        .pan::after {
            content: '';
            position: absolute;
            top: -40px;
            left: 0;
            width: 100%;
            height: 40px;
            border-left: 2px solid #555;
            border-right: 2px solid #555;
            transform: perspective(50px) rotateX(10deg);
            opacity: 0.5;
        }

        .tilt-left { transform: rotate(-15deg); }
        .tilt-right { transform: rotate(15deg); }
        .balanced { transform: rotate(0deg); }
        .shake { animation: shake 0.5s; }

        @keyframes shake {
            0% { transform: rotate(0deg); }
            25% { transform: rotate(5deg); }
            50% { transform: rotate(-5deg); }
            75% { transform: rotate(5deg); }
            100% { transform: rotate(0deg); }
        }

        .message-box {
            background: #e1bee7;
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 20px;
            min-height: 60px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.2em;
        }

        /* æ–°çš„æŒ‰éˆ•æ’ç‰ˆå€ */
        .controls-wrapper {
            display: flex;
            justify-content: space-around;
            margin-top: 20px;
            flex-wrap: wrap;
        }

        .control-group {
            background: #f5f5f5;
            padding: 15px;
            border-radius: 10px;
            display: flex;
            flex-direction: column;
            gap: 10px;
            min-width: 150px;
        }

        .control-group h3 {
            margin: 0 0 10px 0;
            font-size: 16px;
            color: #666;
        }

        button {
            color: white;
            border: none;
            padding: 10px 20px;
            font-size: 18px;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.2s;
            font-weight: bold;
        }

        .btn-add { background-color: var(--primary-color); }
        .btn-sub { background-color: #d81b60; }

        button:hover { transform: scale(1.05); filter: brightness(1.1); }
        button:disabled { background-color: #ccc; cursor: not-allowed; transform: none; }

        .gem-container {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin-top: 20px;
        }

        .gem {
            width: 40px;
            height: 40px;
            background: #ccc;
            border-radius: 50%;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 20px;
            transition: all 0.5s;
        }
        .gem.active {
            background: var(--secondary-color);
            box-shadow: 0 0 15px var(--secondary-color);
            animation: pop 0.5s;
        }

        .bird {
            position: absolute;
            font-size: 60px;
            cursor: pointer;
            z-index: 10;
            animation: bounce 1s infinite alternate;
        }
        
        .hidden-content { filter: blur(10px); transition: filter 0.5s; }

        .input-group {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            margin-bottom: 10px;
        }
        input[type="number"] {
            width: 60px;
            padding: 5px;
            font-size: 18px;
            text-align: center;
        }

        @keyframes bounce { from { transform: translateY(0); } to { transform: translateY(-10px); } }
        @keyframes pop { 0% { transform: scale(0); } 80% { transform: scale(1.2); } 100% { transform: scale(1); } }

    </style>
</head>
<body>

    <div class="game-container">
        <h1>âš–ï¸ å¤©å¹³å®ˆè­·è€…ï¼šåŠ æ¸›çš„æŠ‰æ“‡</h1>
        <div id="level-indicator">Level 1</div>
        
        <div class="message-box">
            <span id="guardian-text">...</span>
        </div>

        <div class="balance-area">
            <div class="balance-beam balanced" id="beam">
                <div class="pan pan-left" id="pan-left"></div>
                <div class="pan pan-right" id="pan-right"></div>
            </div>
            <div class="balance-stand"></div>
        </div>

        <div id="boss-input-area" style="display:none;">
            <div class="input-group">
                <span>T + 13 - </span>
                <input type="number" id="input-left" placeholder="?">
                <span> = 20 - </span>
                <input type="number" id="input-right" placeholder="?">
            </div>
            <button class="btn-add" onclick="checkBossInput()">è§£é–‹é–éˆ</button>
        </div>

        <div class="controls-wrapper" id="controls">
            </div>

        <div class="gem-container" id="gems">
            <div class="gem" id="gem-1">ğŸŒ‘</div>
            <div class="gem" id="gem-2">ğŸŒ‘</div>
            <div class="gem" id="gem-3">ğŸŒ‘</div>
            <div class="gem" id="gem-4">ğŸŒ‘</div>
            <div class="gem" id="gem-5">ğŸŒ‘</div>
        </div>
    </div>

    <script>
        // éŠæˆ²ç‹€æ…‹èˆ‡è³‡æ–™
        const levels = [
            {
                id: 1,
                title: "ç¬¬1é—œï¼šåˆå­¸è€…å¤©å¹³",
                text: "é¡Œç›®ï¼šb + 8 = 14ã€‚ä½ æƒ³æ¶ˆé™¤ +8ï¼Œè©²ç”¨åŠ æ³•é‚„æ˜¯æ¸›æ³•ï¼Ÿ",
                leftContent: "b + 8",
                rightContent: "14",
                targetNum: 8,       // é€™æ¬¡è¦è™•ç†çš„æ•¸å­—
                correctOp: "sub",   // æ­£ç¢ºæ“ä½œï¼šæ¸›æ³• (sub) æˆ– åŠ æ³• (add)
                answerLeft: "b",
                answerRight: "6",
                winMsg: "å¹³è¡¡æ°¸å­˜ï¼æ¸›å»8æ˜¯æ­£ç¢ºçš„é¸æ“‡ï¼"
            },
            {
                id: 2,
                title: "ç¬¬2é—œï¼šå€’éä¾†çš„å¤©å¹³",
                text: "é¡Œç›®ï¼š27 = N + 15ã€‚N åœ¨å³é‚Šï¼Œè¦æŠŠ +15 è®Šä¸è¦‹ï¼",
                leftContent: "27",
                rightContent: "N + 15",
                targetNum: 15,
                correctOp: "sub",
                answerLeft: "12",
                answerRight: "N",
                winMsg: "åšå¾—å¥½ï¼ä¸ç®¡åœ¨å“ªä¸€é‚Šï¼ŒåŠ æ³•éƒ½è¦ç”¨æ¸›æ³•æ¶ˆé™¤ã€‚"
            },
            {
                id: 3,
                title: "ç¬¬3é—œï¼šéš±è—çš„æ•¸å­—",
                text: "é¡Œç›®ï¼š16 = p + 7ã€‚å®ˆè­·è€…åœ¨çœ‹è‘—ä½ ï¼Œåˆ¥é¸éŒ¯å’’èªï¼",
                leftContent: "16",
                rightContent: "p + 7",
                targetNum: 7,
                correctOp: "sub",
                answerLeft: "9",
                answerRight: "p",
                winMsg: "å®Œå…¨æ­£ç¢ºï¼æ¸›7æœ€å®‰å…¨ï¼"
            },
            {
                id: 4,
                title: "ç¬¬4é—œï¼šé³¥å…’çš„è€ƒé©—",
                text: "é¡Œç›®ï¼š5 + H = 12ã€‚å…ˆè¶•èµ°é‚£éš»é³¥ï¼Œå†æ±ºå®šæ€éº¼åšï¼",
                leftContent: "<span id='h-val' class='hidden-content'>H</span> + 5",
                rightContent: "12",
                hasBird: true,
                targetNum: 5,
                correctOp: "sub",
                answerLeft: "H",
                answerRight: "7",
                winMsg: "é³¥å…’é£›èµ°äº†ï¼ŒH è‡ªç”±äº†ï¼"
            },
            {
                id: 5,
                title: "ç¬¬5é—œï¼šæœ€çµ‚Bossé—œ",
                text: "é¡Œç›®ï¼šT + 13 = 20ã€‚å…ˆè§£é™¤é–éˆï¼Œå†é€²è¡Œå¤©å¹³æ“ä½œï¼",
                leftContent: "T + 13",
                rightContent: "20",
                isBoss: true,
                targetNum: 13,
                correctOp: "sub",
                answerLeft: "T",
                answerRight: "7",
                winMsg: "æ­å–œï¼ä½ å·²é›†é½Š5å¡Šå¯¶çŸ³ï¼Œæˆç‚ºçœŸæ­£çš„å¤©å¹³å¤§å¸«ï¼"
            }
        ];

        let currentLevelIndex = 0;
        let leftState = 0; // 0: æœªæ“ä½œ, 1: å·²æ“ä½œ
        let rightState = 0;

        function initLevel() {
            const level = levels[currentLevelIndex];
            const beam = document.getElementById('beam');
            const controls = document.getElementById('controls');
            const bossArea = document.getElementById('boss-input-area');
            
            // Reset
            leftState = 0;
            rightState = 0;
            beam.className = 'balance-beam balanced';
            bossArea.style.display = 'none';
            controls.innerHTML = '';

            document.getElementById('level-indicator').innerText = level.title;
            document.getElementById('guardian-text').innerText = level.text;
            document.getElementById('pan-left').innerHTML = level.leftContent;
            document.getElementById('pan-right').innerHTML = level.rightContent;

            if (level.hasBird) {
                const bird = document.createElement('div');
                bird.innerText = 'ğŸ¦';
                bird.className = 'bird';
                bird.style.left = '30px';
                bird.style.top = '-50px';
                bird.onclick = function() {
                    this.style.display = 'none';
                    document.getElementById('h-val').classList.remove('hidden-content');
                    document.getElementById('guardian-text').innerText = "ç¾åœ¨è¦æ¶ˆé™¤ +5ï¼Œè«‹é¸æ“‡æ­£ç¢ºçš„é‹ç®—ï¼";
                    renderChoiceButtons(level.targetNum);
                };
                document.getElementById('pan-left').appendChild(bird);
                document.getElementById('guardian-text').innerText = "æœ‰æ±è¥¿æ“‹ä½äº†æœªçŸ¥æ•¸ï¼Œé»æ“Šè¶•èµ°å®ƒï¼";
            } else if (level.isBoss) {
                bossArea.style.display = 'flex';
            } else {
                renderChoiceButtons(level.targetNum);
            }
        }

        // æ¸²æŸ“é¸æ“‡æŒ‰éˆ• (åŠ /æ¸›)
        function renderChoiceButtons(num) {
            const controls = document.getElementById('controls');
            
            // å·¦é‚Šæ§åˆ¶å€
            const leftGroup = document.createElement('div');
            leftGroup.className = 'control-group';
            leftGroup.innerHTML = `<h3>å·¦é‚Šå¤©å¹³</h3>`;
            
            const btnLeftAdd = createBtn('left', 'add', num);
            const btnLeftSub = createBtn('left', 'sub', num);
            leftGroup.appendChild(btnLeftAdd);
            leftGroup.appendChild(btnLeftSub);

            // å³é‚Šæ§åˆ¶å€
            const rightGroup = document.createElement('div');
            rightGroup.className = 'control-group';
            rightGroup.innerHTML = `<h3>å³é‚Šå¤©å¹³</h3>`;

            const btnRightAdd = createBtn('right', 'add', num);
            const btnRightSub = createBtn('right', 'sub', num);
            rightGroup.appendChild(btnRightAdd);
            rightGroup.appendChild(btnRightSub);

            controls.appendChild(leftGroup);
            controls.appendChild(rightGroup);
        }

        function createBtn(side, op, num) {
            const btn = document.createElement('button');
            const opSymbol = op === 'add' ? '+' : '-';
            btn.innerText = `${opSymbol} ${num}`;
            btn.className = op === 'add' ? 'btn-add' : 'btn-sub';
            btn.onclick = () => checkAction(side, op, num, btn);
            return btn;
        }

        // æª¢æŸ¥ç©å®¶é¸æ“‡æ˜¯å¦æ­£ç¢º
        function checkAction(side, op, num, btn) {
            const level = levels[currentLevelIndex];
            const beam = document.getElementById('beam');

            // åˆ¤æ–·é‚è¼¯ï¼šå¦‚æœç©å®¶é¸çš„é‹ç®—è·Ÿæ­£ç¢ºç­”æ¡ˆä¸åŒ
            if (op !== level.correctOp) {
                // éŒ¯èª¤ç‰¹æ•ˆ
                beam.classList.add('shake');
                setTimeout(() => beam.classList.remove('shake'), 500);
                
                // æç¤ºæ–‡å­—
                if(op === 'add') {
                    document.getElementById('guardian-text').innerText = `å“å‘€ï¼åŸæœ¬æ˜¯ +${num}ï¼Œå†åŠ  ${num} æœƒè®Šæˆ +${num*2}ï¼Œæ›´è¤‡é›œäº†ï¼`;
                } else {
                    document.getElementById('guardian-text').innerText = `è©¦è©¦çœ‹åˆ¥çš„ï¼Ÿé€™å€‹æ–¹å‘ä¸å°å–”ã€‚`;
                }
                return; // é˜»æ­¢åŸ·è¡Œ
            }

            // å¦‚æœé¸å°äº†ï¼ŒåŸ·è¡Œå¹³è¡¡å‹•ä½œ
            btn.disabled = true; // é–å®šè©²æŒ‰éˆ•
            // é–å®šåŒå´çš„å¦ä¸€å€‹æŒ‰éˆ• (é¿å…åˆåŠ åˆæ¸›)
            const parent = btn.parentElement;
            const siblings = parent.getElementsByTagName('button');
            for(let sb of siblings) sb.disabled = true;

            modifyBalance(side, op, num);
        }

        function modifyBalance(side, op, num) {
            const beam = document.getElementById('beam');
            const opText = op === 'add' ? `+${num}` : `-${num}`;
            const level = levels[currentLevelIndex];

            if (side === 'left') {
                leftState = 1;
                document.getElementById('pan-left').innerHTML += ` <br><small style='color:red'>(${opText})</small>`;
            } else {
                rightState = 1;
                document.getElementById('pan-right').innerHTML += ` <br><small style='color:red'>(${opText})</small>`;
            }

            // è™•ç†å¤©å¹³å‚¾æ–œ
            if (leftState === 1 && rightState === 0) {
                beam.className = 'balance-beam tilt-right'; 
                document.getElementById('guardian-text').innerText = "å¤©å¹³æ­ªäº†ï¼è¨˜å¾—ï¼šå·¦é‚Šåšä»€éº¼ï¼Œå³é‚Šä¹Ÿè¦åšä»€éº¼ï¼";
            } else if (leftState === 0 && rightState === 1) {
                beam.className = 'balance-beam tilt-left';
                document.getElementById('guardian-text').innerText = "ä¸å¹³è¡¡äº†ï¼å¿«å»æ“ä½œå¦ä¸€é‚Šï¼";
            } else if (leftState === 1 && rightState === 1) {
                beam.className = 'balance-beam balanced';
                setTimeout(() => finishLevel(), 1000);
            }
        }

        function checkBossInput() {
            const val1 = document.getElementById('input-left').value;
            const val2 = document.getElementById('input-right').value;
            
            if (val1 == 13 && val2 == 13) {
                document.getElementById('boss-input-area').style.display = 'none';
                document.getElementById('guardian-text').innerText = "é–éˆè§£é–‹ï¼ç¾åœ¨é¸æ“‡æ­£ç¢ºçš„é‹ç®—ä¾†æ¶ˆé™¤ 13ï¼";
                renderChoiceButtons(levels[currentLevelIndex].targetNum);
            } else {
                document.getElementById('guardian-text').innerText = "å’’èªéŒ¯èª¤ï¼æˆ‘å€‘è¦æ¶ˆé™¤ +13ï¼Œæ‡‰è©²å¡«ä»€éº¼æ•¸å­—ï¼Ÿ";
            }
        }

        function finishLevel() {
            const level = levels[currentLevelIndex];
            document.getElementById('pan-left').innerHTML = level.answerLeft;
            document.getElementById('pan-right').innerHTML = level.answerRight;
            document.getElementById('guardian-text').innerText = level.winMsg;
            
            const gem = document.getElementById(`gem-${currentLevelIndex + 1}`);
            gem.innerText = 'ğŸ’';
            gem.classList.add('active');

            const controls = document.getElementById('controls');
            controls.innerHTML = '';
            
            if (currentLevelIndex < levels.length - 1) {
                const nextBtn = document.createElement('button');
                nextBtn.className = 'btn-add'; // Reuse style
                nextBtn.innerText = "å‰å¾€ä¸‹ä¸€é—œ â¡ï¸";
                nextBtn.onclick = () => {
                    currentLevelIndex++;
                    initLevel();
                };
                controls.appendChild(nextBtn);
            } else {
                document.querySelector('h1').innerText = "ğŸ‰ ä»»å‹™å®Œæˆï¼ ğŸ‰";
                controls.innerHTML = "<h3>æ­å–œæˆç‚ºæ­£å¼çš„å¤©å¹³å®ˆè­·è€…ï¼</h3>";
            }
        }

        initLevel();
    </script>
</body>
</html>